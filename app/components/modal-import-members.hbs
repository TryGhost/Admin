<div class="gh-member-import-wrapper {{if (or (eq this.state 'MAPPING') (eq this.state 'UPLOADING')) "wide"}}">
    {{#if (eq this.state 'INIT')}}
        <header class="modal-header" data-test-modal="import-members">
            <h1>{{t "Manual.Members.Import_members"}}</h1>
        </header>
    {{/if}}

    {{#if (or (eq this.state 'MAPPING') (eq this.state 'UPLOADING'))}}
        <header class="modal-header" data-test-modal="import-members">
            <h1>{{t "Manual.Members.Import_members"}}</h1>
        </header>
    {{/if}}

    {{#if (eq this.state 'PROCESSING')}}
        <header class="modal-header icon-center" data-test-modal="import-members">
            <GhLoadingSpinner />
            <h1>{{t "Manual.Components.Import_in_progress"}}</h1>
        </header>
    {{/if}}

    {{#if (eq this.state 'COMPLETE')}}
        <header class="modal-header icon-center" data-test-modal="import-members">
            {{#if this.importResponse.errorCount}}
                {{#if (eq this.importResponse.importedCount 0)}}
                    {{svg-jar "members-outline" class="gh-member-import-icon-members midgrey"}}
                {{else}}
                    {{svg-jar "members-outline" class="gh-member-import-icon-members green"}}
                {{/if}}
            {{else}}
                {{svg-jar "confetti" class="gh-member-import-icon-confetti"}}
            {{/if}}
            <h1>{{t "Manual.Components.Import_complete"}}</h1>
        </header>
    {{/if}}

    {{#if (eq this.state 'ERROR')}}
        <header class="modal-header" data-test-modal="import-members">
            <h1>{{this.errorHeader}}</h1>
        </header>
    {{/if}}

    <a class="close" href="" role="button" title="Close" {{action "closeModal"}}>
        {{svg-jar "close"}}
        <span class="hidden">{{t "Manual.Components.Close"}}</span>
    </a>

    <div class="modal-body">
        {{#if (eq this.state 'INIT')}}
            <ModalImportMembers::CsvFileSelect @setFile={{action "setFile"}} />
        {{/if}}

        {{#if (or (eq this.state 'MAPPING') (eq this.state 'UPLOADING'))}}
            <ModalImportMembers::CsvFileMapping
                @file={{this.file}}
                @setMappingResult={{action "setMappingResult"}}
                @setFileData={{action "setMappingFileData"}}
                @showErrors={{this.showMappingErrors}}
                @disabled={{if (or (eq this.state 'UPLOADING') (eq this.mappingResult.membersCount 0)) true false}}
            />
        {{/if}}

        {{#if (eq this.state 'PROCESSING')}}
        <div class="gh-member-import-resultcontainer">
            <div class="gh-member-import-result-summary">
                <p> {{t "Manual.Components.Your_import_is_being_processed,_and_you’ll_receive_a_confirmation_email_as_soon_as_it’s_complete._Usually_this_only_takes_a_few_minutes,_but_larger_imports_may_take_longer"}}</p>
            </div>
        </div>
        {{/if}}

        {{#if (eq this.state 'COMPLETE')}}
            <div class="gh-member-import-resultcontainer">
                {{#if (eq this.importResponse.importedCount 0)}}
                <div class="gh-member-import-result-summary">
                    <p>{{t "Manual.Components.No_members_were_added"}}{{if this.importResponse.errorCount " due to the following errors:" "."}}</p>
                </div>
                {{else}}
                <div class="gh-member-import-result-summary">
                    <p>{{t "Manual.Components.A_total_of"}} <strong>{{format-number this.importResponse.importedCount}}</strong> {{gh-pluralize this.importResponse.importedCount 'person' without-count=true}} {{t "Manual.Components.were_successfully_added_or_updated_in_your_list_of_members,_and_now_have_access_to_your_site"}}</p>
                </div>
                {{/if}}
                {{#if this.importResponse.errorCount}}
                    {{#unless (eq this.importResponse.importedCount 0)}}
                        <hr>
                        <div class="gh-member-import-result-summary">
                            <p><strong>{{format-number this.importResponse.errorCount}}</strong> {{gh-pluralize this.importResponse.errorCount "member" without-count=true}} {{if (eq this.importResponse.errorCount 1) "was" "were"}} {{t "Manual.Components.skipped_due_to_the_following_errors"}}</p>
                        </div>
                    {{/unless}}
                    <div class="gh-member-import-errorlist">
                        <ul>
                        {{#each this.importResponse.errorList as |error|}}
                            <li>{{error.message}} ({{error.count}}) </li>
                        {{/each}}
                        </ul>
                    </div>
                {{/if}}
            </div>
        {{/if}}

        {{#if (eq this.state 'ERROR')}}
            <div class="failed flex items-start gh-members-upload-errorcontainer error">
                <div class="mr2">{{svg-jar "warning" class="nudge-top--2 w4 h4 fill-red"}}</div>
                <p class="ma0 pa0">{{this.errorMessage}}</p>
            </div>
        {{/if}}
    </div>

    <div class="modal-footer modal-footer-spread">
        {{#if (eq this.state 'INIT')}}
            <button {{action "closeModal"}} class="gh-btn" data-test-button="close-import-members">
                <span>{{t "Manual.Members.Close"}}</span>
            </button>
            <a
                class="gh-btn"
                href="https://static.ghost.org/v4.0.0/files/member-import-template.csv"
                target="_blank"
            >
                <span>{{t "Manual.Members.Download_sample_CSV_file"}}</span>
            </a>
        {{/if}}

        {{#if (eq this.state 'MAPPING')}}
            <button {{action "reset"}} class="gh-btn" data-test-button="restart-import-members">
                <span>{{t "Manual.Members.Start_over"}}</span>
            </button>
            <button class="gh-btn gh-btn-green {{unless this.mappingResult.membersCount "disabled"}}" {{action "upload"}}>
                {{#if this.mappingResult.membersCount}}
                    <span>{{t "Manual.Settings.Import"}} {{format-number this.mappingResult.membersCount}} {{gh-pluralize this.mappingResult.membersCount 'member' without-count=true}}</span>
                {{else}}
                    <span>{{t "Manual.Members.Import_members"}}</span>
                {{/if}}
            </button>
        {{/if}}

        {{#if (eq this.state 'UPLOADING')}}
            <button {{action "reset"}} class="gh-btn disabled" disabled="disabled" data-test-button="restart-import-members">
                <span>{{t "Manual.Members.Start_over"}}</span>
            </button>
            <button class="gh-btn gh-btn-green gh-btn-icon disabled" disabled="disabled" {{action "upload"}}>
                <span>{{svg-jar "spinner" class="gh-icon-spinner"}} {{this.runningText}}{{t "Manual.Components.Uploading"}}</span>
            </button>
        {{/if}}

        {{#if (eq this.state 'COMPLETE')}}
            {{#if this.importResponse.errorCount}}
                <a href="{{this.importResponse.errorCsvUrl}}" download="{{this.importResponse.errorCsvName}}" class="gh-btn" data-test-button="restart-import-members">
                    <span>{{t "Manual.Components.Download_error_file"}}</span>
                </a>
                {{#if (eq this.importResponse.importedCount 0)}}
                    <button {{action "reset"}} class="gh-btn gh-btn-black" data-test-button="restart-import-members">
                        <span>{{t "Manual.Components.Try_again"}}</span>
                    </button>
                {{else}}
                    <button {{action "closeModal"}} class="gh-btn gh-btn-black" data-test-button="close-import-members">
                        <span>{{t "Manual.Components.View_members"}}</span>
                    </button>
                {{/if}}
            {{else}}
                {{#if (eq this.importResponse.importedCount 0)}}
                    <button {{action "closeModal"}} class="gh-btn" data-test-button="close-import-members">
                        <span>{{t "Manual.Components.Close"}}</span>
                    </button>
                    <button {{action "reset"}} class="gh-btn gh-btn-black" data-test-button="restart-import-members">
                        <span>{{t "Manual.Components.Try_again"}}</span>
                    </button>
                {{else}}
                    <button {{action "reset"}} class="gh-btn" data-test-button="restart-import-members">
                        <span>{{t "Manual.Components.Upload_another_file"}}</span>
                    </button>
                    <button {{action "closeModal"}} class="gh-btn gh-btn-black" data-test-button="close-import-members">
                        <span>{{t "Manual.Components.View_members"}}</span>
                    </button>
                {{/if}}
            {{/if}}
        {{/if}}

        {{#if (eq this.state 'PROCESSING')}}
            <button {{action "reset"}} class="gh-btn" data-test-button="restart-import-members">
                <span>{{t "Manual.Components.Upload_another_file"}}</span>
            </button>
            <button {{action "closeModal"}} class="gh-btn gh-btn-black" data-test-button="close-import-members">
                <span>{{t "Manual.Components.Got_it"}}</span>
            </button>
        {{/if}}

        {{#if (eq this.state 'ERROR')}}
            <button {{action "reset"}} class="gh-btn" data-test-button="restart-import-members">
                <span>{{t "Manual.Components.Try_again"}}</span>
            </button>
            <button {{action "closeModal"}} class="gh-btn gh-btn-black" data-test-button="close-import-members">
                <span>OK</span>
            </button>
        {{/if}}
    </div>
</div>