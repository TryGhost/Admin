<section class="gh-view">
    <header class="view-header">
        {{#gh-view-title openMobileMenu="openMobileMenu"}}
            {{link-to "Team" "team"}}
            <i class="icon-arrow-right"></i> <span>{{user.name}}</span>
        {{/gh-view-title}}

        <section class="view-actions">
            {{#if userActionsAreVisible}}
                <span class="dropdown">
                    {{#gh-dropdown-button dropdownName="user-actions-menu" classNames="btn btn-default only-has-icon user-actions-cog" title="User Actions"}}
                        <i class="icon-settings"></i>
                        <span class="hidden">User Settings</span>
                    {{/gh-dropdown-button}}

                    {{#gh-dropdown name="user-actions-menu" tagName="ul" classNames="user-actions-menu dropdown-menu dropdown-triangle-top-right"}}
                        {{#if canMakeOwner}}
                            <li>
                                <button {{action "toggleTransferOwnerModal"}}>
                                    Make Owner
                                </button>

                                {{#if showTransferOwnerModal}}
                                    {{gh-fullscreen-modal
                                        "transfer-owner"
                                        confirm=(action "transferOwnership")
                                        close=(action "toggleTransferOwnerModal")
                                        modifier="action wide"
                                    }}
                                {{/if}}
                            </li>
                        {{/if}}

                        {{#if deleteUserActionIsVisible}}
                            <li>
                                <button {{action "toggleDeleteUserModal"}} class="delete">
                                    Delete User
                                </button>

                                {{#if showDeleteUserModal}}
                                    {{gh-fullscreen-modal
                                        "delete-user"
                                        confirm=(action "deleteUser")
                                        close=(action "toggleDeleteUserModal")
                                        modifier="action wide"
                                    }}
                                {{/if}}
                            </li>
                        {{/if}}
                    {{/gh-dropdown}}
                </span>
            {{/if}}

            {{#gh-spin-button class="btn btn-blue" action="save" submitting=submitting}}Save{{/gh-spin-button}}
        </section>
    </header>

    <div class="view-container settings-user">
        <figure class="user-cover" style={{coverImageBackground}}>
            <button class="btn btn-default user-cover-edit" {{action "toggleUploadCoverModal"}}>Change Cover</button>

            {{#if showUploadCoverModal}}
                {{gh-fullscreen-modal
                    "upload-image"
                    model=(hash model=user imageProperty="cover")
                    close=(action "toggleUploadCoverModal")
                    modifier="action wide"
                }}
            {{/if}}
        </figure>

        <form class="user-profile" novalidate="novalidate" autocomplete="off">
            {{!-- Horrible hack to prevent Chrome from incorrectly auto-filling inputs --}}
            <input style="display:none;" type="text" name="fakeusernameremembered"/>
            <input style="display:none;" type="password" name="fakepasswordremembered"/>

            <fieldset class="user-details-top">
                <figure class="user-image">
                    <div id="user-image" class="img" style={{userImageBackground}}>
                        <span class="hidden">{{user.name}}"s Picture</span>
                    </div>

                    <button type="button" {{action "toggleUploadImageModal"}} class="edit-user-image">Edit Picture</button>

                    {{#if showUploadImageModal}}
                        {{gh-fullscreen-modal
                            "upload-image"
                            model=(hash model=user imageProperty="image")
                            close=(action "toggleUploadImageModal")
                            modifier="action wide"
                        }}
                    {{/if}}
                </figure>

                {{gh-validated-textfield
                    "name"
                    user.changeset
                    label="Full Name"
                    class="first-form-group"
                    classes="user-name"
                    name="user[name]"
                    placeholder="Full Name"
                    autocorrect="off"
                    helpText="Use your real name so people can recognise you"
                }}
            </fieldset>

            <fieldset class="user-details-bottom">
                {{#gh-validated-textfield
                    "slug"
                    user.changeset
                    label="Slug"
                    classes="user-name"
                    name="user[slug]"
                    placeholder="Slug"
                    selectOnClick=true
                    autocorrect="off"
                    focusOut=(action "updateSlug")
                }}
                    {{gh-blog-url}}/author/{{user.changeset.slug}}
                {{/gh-validated-textfield}}

                {{#gh-validation-container "email" user.changeset helpText="Used for notifications" as |value actions|}}
                    <label for="user-email">Email</label>
                    {{!-- Administrators only see text of Owner's email address but not input --}}
                    {{#unless isAdminUserOnOwnerProfile}}
                        {{gh-input value type="email" id="user-email" name="email" placeholder="Email Address" autocapitalize="off" autocorrect="off" autocomplete="off" focusOut=actions.focusOut update=actions.update}}
                    {{else}}
                        <span>{{value}}</span>
                    {{/unless}}
                {{/gh-validation-container}}

                {{#if rolesDropdownIsVisible}}
                    <div class="form-group">
                        <label for="user-role">Role</label>
                        <span class="gh-select" tabindex="0">
                            {{gh-select-native
                                id="new-user-role"
                                content=roles
                                optionValuePath="id"
                                optionLabelPath="name"
                                selection=model.role
                                action=(action "changeRole")
                            }}
                        </span>
                        <p>What permissions should this user have?</p>
                    </div>
                {{/if}}

                {{gh-validated-textfield
                    "location"
                    user.changeset
                    label="Location"
                    name="user[location]"
                    placeholder="Location"
                    helpText="Where in the world do you live?"
                }}

                {{gh-validated-textfield
                    "website"
                    user.changeset
                    label="Website"
                    type="url"
                    name="user[website]"
                    placeholder="Website"
                    autocapitalize="off"
                    autocorrect="off"
                    autocomplete="off"
                    helpText="Have a website or blog other than this one? Link it!"
                }}

                {{gh-validated-textfield
                    "facebook"
                    user.changeset
                    type="url"
                    name="user[facebook]"
                    placeholder="https://www.facebook.com/username"
                    autocorrect="off"
                    helpText="URL of your personal Facebook profile"
                    focusOut=(action "validateFacebook")
                }}

                {{gh-validated-textfield
                    "twitter"
                    user.changeset
                    type="url"
                    name="user[twitter]"
                    placeholder="https://twitter.com/username"
                    autocorrect="off"
                    helpText="URL of your personal Twitter profile"
                    focusOut=(action "validateTwitter")
                }}

                {{#gh-validated-textarea "bio" user.changeset class="bio-container" label="Bio"}}
                    Write about you, in 200 characters or less. {{gh-count-characters user.changeset.bio}}
                {{/gh-validated-textarea}}

                <hr />
            </fieldset>

            {{!-- If an administrator is viewing Owner's profile then hide inputs for change password --}}
            {{#unless isAdminUserOnOwnerProfile}}
                <fieldset>
                    {{#unless isNotOwnProfile}}
                        {{gh-validated-textfield
                            "oldPassword"
                            passwordModel.changeset
                            type="password"
                            label="Old Password"
                            placeholder="Old Password"
                            name="user[oldPassword]"
                            focusOut=(action "validatePassword")
                        }}
                    {{/unless}}

                    {{gh-validated-textfield
                        "newPassword"
                        passwordModel.changeset
                        type="password"
                        label="New Password"
                        placeholder="New Password"
                        name="user[newPassword]"
                    }}

                    {{gh-validated-textfield
                        "ne2Password"
                        passwordModel.changeset
                        type="password"
                        label="Verify Password"
                        placeholder="Verify Password"
                        name="user[verifyPassword]"
                    }}

                    <div class="form-group">
                        {{#gh-spin-button class="btn btn-red button-change-password" action=(action "changePassword") submitting=updatingPassword}}Change Password{{/gh-spin-button}}
                    </div>
                </fieldset>
            {{/unless}}
        </form>
    </div>
</section>
